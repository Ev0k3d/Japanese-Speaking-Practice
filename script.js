const rolePlayCards2019 = {
  "2019 HR1": [
    "こんばんは。どうしましたか。",
    "いつからですか。",
    "きょうのごご、何をしましたか。",
    "はい、えきのとなりにあります。"
    "だいじょうぶですよ。日本のこんびには二十四じかんオープンです。"
  ],
  "2019 HR2": [
    "いらっしゃいませ。",
    "ちょっとみせてください。どこで買いましたか。",
    "はい。",
    "いつまで青森にいますか。",
    "二万円です。"
  ],
  "2019 HR3": [
    "学校は何時から何時までですか。",
    "昨日、昼休みに何をしましたか。",
    "どの先生が好きですか。",
    "制服はどんなですか。",
    "将来、どんな仕事がしたいですか。"
  ],
  "2019 HR4": [
    "こんにちは。",
    "どうしてこのレストランでアルバイトがしたいですか。",
    "いつから日本語を勉強していますか。",
    "週に何時間働きますか。",
    "仕事の服は何ですか。"
  ],
  "2019 HR5": [
    "一番好きな友だちは、だれですか。どうしてですか。",
    "最近、その友だちと何をしましたか。",
    "その友だちの誕生日はいつですか。",
    "家族は何人ですか。",
    "どこに住んでいますか。"
  ],
  "2019 HR6": [
    "京都へようこそ。どうして京都にいらっしゃいましたか。",
    "今まで、京都で何をしましたか。",
    "京都で何が買いたいですか。",
    "おすすめのお寺はありますか。",
    "次のバスは何時ですか。"
  ],
  "2019 HR7": [
    "こんにちは。この学校で、どんなボランティアがしたいですか。",
    "何が得意ですか。",
    "いつから、それをしていますか。",
    "今、ボランティアの仕事はありますか。",
    "学校は何時に始まりますか。"
  ],
  "2019 HR8": [
    "日本に、あとどのぐらいいますか。",
    "日本の学校はどうですか。",
    "先週、学校で何をしましたか。",
    "昼ごはんはどこで食べますか。",
    "クラブに入っていますか。"
  ],
  "2019 HR9": [
    "スポーツは何が好きですか。どうしてですか。",
    "いつ、どこで、そのスポーツをしますか。",
    "何才から、そのスポーツをしていますか。",
    "スポーツのチケットはいくらですか。",
    "週末は何をしますか。"
  ],
  "2019 HR10": [
    "毎日何時に家に帰りますか。",
    "それから、何をしますか。",
    "今日、学校で何をしましたか。",
    "晩ごはんは何時に食べますか。",
    "晩ごはんはだれが作りますか。"
  ]
};


const pictureBasedCards2019 = {
  "2019 HP1": [
    "このしゃしんについてはなしてください。",
    "じどうはんばいきについて、どうおもいますか。",
    "さいきん、どこでかいものをしましたか。",
    "ともだちのたんじょうびプレゼントに、なにをかいますか。",
    "かいものはインターネットでしますか。それとも、まちにいきますか。"
  ],
  "2019 HP2": [
    "このしゃしんについてはなしてください。",
    "パーティーについて、どうおもいますか。",
    "いままで、まつりでなにをしましたか。",
    "こんどのたんじょうびに、なにがほしいですか。",
    "こんどのクリスマスに、なにをしますか。"
  ],
  "2019 HP3": [
    "このしゃしんについてはなしてください。",
    "きものについて、どうおもいますか。",
    "さいきん、どんなようふくをかいましたか。",
    "しょうらい、せいふくがきたいですか。",
    "こんどのしゅうまつ、なにがかいたいですか。"
  ],
  "2019 HP4": [
    "このしゃしんについてはなしてください。",
    "グループりょこうについて、どうおもいますか。",
    "さいきん、どんなおもしろいまちにいきましたか。",
    "こんど、いなかでなにがしたいですか。",
    "ことしのなつ、どこにいきたいですか。"
  ],
  "2019 HP5": [
    "このしゃしんについてはなしてください。",
    "しゅうがくりょこうについて、どうおもいますか。",
    "きょうしつのそとで、どんなことをべんきょうしましたか。",
    "しょうらい、しゅうがくりょこうで、どこにいきたいですか。",
    "がっこうで、どんなあたらしいイベントがしたいですか。"
  ],
  "2019 HP6": [
    "このしゃしんについてはなしてください。",
    "にほんのスポーツについて、どうおもいますか。",
    "いままで、どんなクラブかつどうをしましたか。",
    "これから、どんなしゅうがくりょこうにいきたいですか。",
    "しょうらい、がっこうでなにがしたいですか。"
  ],
  "2019 HP7": [
    "このしゃしんについてはなしてください。",
    "アルバイトについて、どうおもいますか。",
    "さいきん、うちでどんなてつだいをしましたか。",
    "アルバイトのおかねでなにをかいたいですか。",
    "しょうらい、どんなしごとがしたいですか。"
  ],
  "2019 HP8": [
    "このしゃしんについてはなしてください。",
    "コンピューターでのべんきょうについて、どうおもいますか。",
    "にほんごのべんきょうで、なにがいちばんむずかしかったですか。",
    "ほかのがいこくごもべんきょうしたいですか。",
    "これから、どうやってにほんごをつかいますか。"
  ],
  "2019 HP9": [
    "このしゃしんについてはなしてください。",
    "かんきょうにいいのりものについて、どうおもいますか。",
    "いままで、どんなリサイクルしましたか。",
    "しょうらい、どんなかんきょうほごかつどうをしたいですか。",
    "がっこうでなにをリサイクルしていますか。"
  ],
  "2019 HP10": [
    "このしゃしんについてはなしてください。",
    "こくさいスポーツ・イベントについて、どうおもいますか。",
    "さいきん、ともだちとスポーツをしましたか。",
    "しょうらい、がいこくりょうりは、なにがたべたいですか。",
    "しょうらい、どんなイベントにいきたいですか。"
  ]
};

const rolePlayCards2022 = {
  "2022 HP1": [
    "ペンフレンドはなんじんですか。",
    "どうしてそのひとがすきですか。",
    "このまえのてがみに、なにについてかきましたか。",
    "しつもんがありますか。",
    "ほかにしつもんがありますか。"
  ],
  "2022 HP2": [
    "パーティーはなんようびのなんじですか。",
    "どうしてパーティーをしますか。",
    "まえのパーティーではなにをしましたか。",
    "しつもんがありますか。",
    "ほかにしつもんがありますか。"
  ],
  "2022 HP3": [
    "いらっしゃいませ。",
    "いま、どこからきょうとにきましたか。",
    "きょうとでなにがしたいですか。",
    "しつもんがありますか。",
    "ほかにしつもんがありますか。"
  ],
  "2022 HP4": [
    "イギリスのなつやすみはなんがつなんにちからですか。",
    "なつやすみになにをしますか。",
    "きょねんのなつやすみ、てんきはどうでしたか。",
    "しつもんがありますか。",
    "ほかにしつもんがありますか。"
  ],
  "2022 HP5": [
    "がっこうのスポーツ・デイはなんがつなんにちですか。",
    "がっこうのスポーツ・デイでなにがいちばんすきですか。",
    "きょねんのスポーツ・デイのてんきは、どうでしたか。",
    "しつもんがありますか。",
    "ほかにしつもんがありますか。"
  ],
  "2022 HP6": [
    "しゅうがくりょこうでなにをしますか。",
    "きょねんのしゅうがくりょこうのてんきはどうでしたか。",
    "しゅうがくりょこうで、だれにどんなおみやげをかいますか。",
    "しつもんがありますか。",
    "ほかにしつもんがありますか。"
  ],
  "2022 HP7": [
    "おかあさんはまいにちなんじからなんじまでしごとをしますか。",
    "おかあさんはどうしてそのしごとがすきですか。",
    "おかあさんはきのうしごとでなにをしましたか。",
    "しつもんがありますか。",
    "ほかにしつもんがありますか。"
  ],
  "2022 HP8": [
    "なんようびのなんじに、ボランティアをしますか。",
    "せんしゅう、ボランティアでなにをしましたか。",
    "どうしてボランティアをしますか。",
    "しつもんがありますか。",
    "ほかにしつもんがありますか。"
  ],
  "2022 HP9": [
    "いらっしゃいませ。",
    "なにごのじしょですか。",
    "にほんごがじょうずですね。いままでにほんでなにをしましたか。",
    "しつもんがありますか。",
    "ほかにしつもんがありますか。"
  ],
  "2022 HP10": [
    "いつ、だれとまつりにいきますか。",
    "どうしてまつりがすきですか。",
    "きょねん、まつりのひのてんきは、どうでしたか。",
    "しつもんがありますか。",
    "ほかにしつもんがありますか。"
  ]
};

const pictureBasedCards2022 = {
  "2022 HP1": [
    "このしゃしんについてはなしてください。",
    "がいこくじんのともだちはいいですね。どうおもいますか。",
    "さいきん、ともだちと なにをしましたか。",
    "しょうらい、ともだちと どこにいきたいですか。",
    "だれとりょこうにいくことがすきですか。"
  ],
  "2022 HP2": [
    "このしゃしんについてはなしてください。",
    "じもとのイベントはいいですね。どうおもいますか。",
    "さいきん、どんなりょうりをつくりましたか。",
    "しょうらい、どんなイベントにいきたいですか。",
    "うちのりょうりがいいですか、それとも、レストランのりょうりがいいですか。"
  ],
  "2022 HP3": [
    "このしゃしんについてはなしてください。",
    "がっこうのびじゅつのじゅぎょうはいいですね。どうおもいますか。",
    "さいきん、どんなてんらんかいにいきましたか。",
    "しょうらい、どんなものをつくりたいですか。",
    "ぶんかのイベントについて、どうおもいますか。"
  ],
  "2022 HP4": [
    "このしゃしんについてはなしてください。",
    "うみはいいですね。どうおもいますか。",
    "きょねんのなつやすみに、どこにいきましたか。",
    "つぎのやすみに、なにがしたいですか。",
    "かぞくでのやすみは、どうですか。"
  ],
  "2022 HP5": [
    "このしゃしんについてはなしてください。",
    "せいふくは かっこいいですね。どうおもいますか。",
    "さいきん、どんなテストが ありましたか。",
    "しけんのあと、なにをしますか。",
    "どんながっこうが、いいがっこうですか。"
  ],
  "2022 HP6": [
    "このしゃしんについてはなしてください。",
    "グループしゃしんはいいですね。どうおもいますか。",
    "さいきん、しゅうがくりょこうでなにをしましたか。",
    "らいねん、しゅうがくりょこうでどこにいきたいですか。",
    "がっこうのりょこうがすきですか、それとも、かぞくでのりょこうがすきですか。"
  ],
  "2022 HP7": [
    "このしゃしんについてはなしてください。",
    "わたしははいしゃにいくことがすきではありません。どうおもいますか。",
    "さいきん、けんこうにいいことは、なにをしましたか。",
    "しょうらい、どうやってひとをたすけますか。",
    "びょういんでのしごとについて、どうおもいますか。"
  ],
  "2022 HP8": [
    "このしゃしんについてはなしてください。",
    "ともだちとのべんきょうはたのしいですね。どうおもいますか。",
    "さいきん、としょかんでなにをしましたか。",
    "しょうらい、どんなほんがよみたいですか。",
    "コンピューターでのべんきょうがすきですか、それとも、ほんをつかってのべんきょうがすきですか。"
  ],
  "2022 HP9": [
    "このしゃしんについてはなしてください。",
    "そとでのかつどうはたのしいですね。どうおもいますか。",
    "さいきん、がいこくじんのともだちと、なにをしましたか。",
    "しょうらい、かんきょうをまもりたいです。どうしますか。",
    "ともだちとのかつどうについて、どうおもいますか。"
  ],
  "2022 HP10": [
    "このしゃしんについてはなしてください。",
    "ともだちと いっしょのかつどうはいいですね。どうおもいますか。",
    "さいきん、なにをして、ともだちをてつだいましたか。",
    "しょうらい、どうやってみずをたいせつにしますか。",
    "かんきょうほごは、ひとりでは、できません。どうおもいますか。"
  ]
};

const rolePlayCards2024 = {
  "2024 RP1": [
    "がっこうで どのすぽーつを しますか。",
    "そのすぽーつは どうですか。",
    "せんしゅう、どこで すぽーつを しましたか。",
    "しつもんが ありますか。",
    "ほかに しつもんが ありますか。"
  ],
  "2024 RP2": [
    "いちばん なかがいい ともだちは、どんなひと ですか。",
    "いっしょに なにを しますか。",
    "どのくらいまえに ともだちに なりましたか。",
    "しつもんが ありますか。",
    "ほかに しつもんが ありますか。"
  ],
  "2024 RP3": [
    "だれに おみやげを かいますか。",
    "どうして そのひとに おみやげを あげますか。",
    "どのくらいまえに にほんに きましたか。",
    "しつもんが ありますか。",
    "ほかに しつもんが ありますか。"
  ],
  "2024 RP4": [
    "どこの うみが すきですか。",
    "だいたい、いつごろ うみに いきますか。",
    "きょねん、うみに いって、なにを しましたか。",
    "しつもんが ありますか。",
    "ほかに しつもんが ありますか。"
  ],
  "2024 RP5": [
    "がっこうでは、どんな しゅうがくりょこうに いきますか。",
    "どうして しゅうがくりょこうが すきですか。",
    "まえの しゅうがくりょこうでは、なにを しましたか。",
    "しつもんが ありますか。",
    "ほかに しつもんが ありますか。"
  ],
  "2024 RP6": [
    "どんな せいふくを きますか。",
    "せいふくについて、どう おもいますか。",
    "どこで せいふくを かいましたか。",
    "しつもんが ありますか。",
    "ほかに しつもんが ありますか。"
  ],
  "2024 RP7": [
    "どの くにに いきたいですか。",
    "そこで どうやって あたらしい ともだちを つくりますか。",
    "どのくらいまえに にほんごの べんきょうを はじめましたか。",
    "しつもんが ありますか。",
    "ほかに しつもんが ありますか。"
  ],
  "2024 RP8": [
    "らいねん、なにを べんきょうしますか。",
    "どうして＊＊を えらびますか。",
    "しょうがっこうでは、どの せんせいが すきでしたか。",
    "しつもんが ありますか。",
    "ほかに しつもんが ありますか。"
  ],
  "2024 RP9": [
    "いらっしゃいませ。どちらに いきますか。",
    "どうして＊＊ですか。",
    "いままで にほんで なにを しましたか。",
    "しつもんが ありますか。",
    "ほかに しつもんが ありますか。"
  ],
  "2024 RP10": [
    "にちようびは、なんじに おきますか。",
    "しゅうまつは、どこに よく いきますか。",
    "せんしゅうの しゅうまつ、ともだちに あいましたね。なにを しましたか。",
    "しつもんが ありますか。",
    "ほかに しつもんが ありますか。"
  ]
};

const pictureBasedCards2024 = {
  "2024 HP1": [
      "このしゃしんについてはなしてください。",
      "たんじょうびぱーてぃーは いいですね。どうおもいますか。",
      "さいきん、ぱーてぃーでなにをたべましたか。",
      "しけんのあと、おいわいで どこへいきますか。",
      "ともだちとのぱーてぃーが いいですか、それとも、かぞくでのぱーてぃーが いいですか。"
  ],
  "2024 HP2": [
      "このしゃしんについてはなしてください。",
      "ここでは、みんなが いっしょに すぽーつを していますね。どうおもいますか。",
      "さいきん、どんなすぽーつをしましたか。",
      "しょうらい、どんなすぽーつ・いべんとにいきたいですか。",
      "がっこうのすぽーつが いいですか。それとも、じもとのちーむのすぽーつが いいですか。"
  ],
  "2024 HP3": [
      "このしゃしんについてはなしてください。",
      "りょこうは いいですね。どうおもいますか。",
      "さいきん、どこにとまりましたか。",
      "しょうらい、どんなしょくにいきたいですか。",
      "あなたのまちについて、どうおもいますか。"
  ],
  "2024 HP4": [
      "このしゃしんについてはなしてください。",
      "ぐるーぷしゃしんは いいですね。どうおもいますか。",
      "さいきん、どこでしゃしんをとりましたか。",
      "つぎのりょこうは、だれといきたいですか。どうしてですか。",
      "はる、なつ、あき、ふゆ、どのきせつがいちばんすきですか。"
  ],
  "2024 HP5": [
      "このしゃしんについてはなしてください。",
      "がっこうのせんせいのはなしは おもしろいですね。どうおもいますか。",
      "さいきん、がっこうのみんなで、どんなことをしましたか。",
      "しょうらい、ゆうめいなひとで、だれからはなしをききたいですか。",
      "がっこうのいろいろないべんとについて、どうおもいますか。"
  ],
  "2024 HP6": [
      "このしゃしんについてはなしてください。",
      "がっこうのこんさーとは いいですね。どうおもいますか。",
      "いままで、どんながっきをならいましたか。",
      "しょうらい、しごとでどのくににいきたいですか。",
      "おんがくかのしごとについて、どうおもいますか。"
  ],
  "2024 HP7": [
      "このしゃしんについてはなしてください。",
      "こどもは かわいいですね。どうおもいますか。",
      "さいきん、どんなすぽーつのいべんとにいきましたか。",
      "しょうらい、がっこうのぐるーぷで どこにいきたいですか。",
      "がっこうのすぽーつについて、どうおもいますか。"
  ],
  "2024 HP8": [
      "このしゃしんについてはなしてください。",
      "こどもとのりょこうはたいへんですね。どうおもいますか。",
      "きょねんのなつ、かぞくのひとと なにをしましたか。",
      "しょうらい、でんしゃにのって、どこにいきたいですか。",
      "ひとりでのりょこうがすきですか、それとも、ぐるーぷりょこうがすきですか。"
  ],
  "2024 HP9": [
      "このしゃしんについてはなしてください。",
      "そとでのこんさーとは いいですね。どうおもいますか。",
      "さいきん、がいこくじんのともだちと、なにをしましたか。",
      "しょうらい、どんなまつりにいきたいですか。",
      "どんなこくさいいべんとがいちばんいいとおもいますか。"
  ],
  "2024 HP10": [
      "このしゃしんについてはなしてください。",
      "がっこうのりさいくる・ぐるーぷは いいですね。どうおもいますか。",
      "せんしゅう、がっこうでどんなぐるーぷかつどうをしましたか。",
      "しょうらい、がっこうをもっときれいにしたいです。どうしますか。",
      "あなたのがっこうのかんきょうほごかつどうについて、どうおもいますか。"
  ]
};


let currentSet = [];
let currentIndex = 0;
let mediaRecorder;
let audioChunks = [];
let transcriptEnabled = false;
const synth = window.speechSynthesis;

const currentQuestion = document.getElementById("currentQuestion");
const nextQuestionButton = document.getElementById("nextQuestionButton");
const skipQuestionButton = document.getElementById("skipQuestionButton");
const showTranscriptButton = document.getElementById("showTranscriptButton");
const transcriptBox = document.getElementById("transcriptBox");
const transcriptContainer = document.getElementById("transcriptContainer");
const downloadSection = document.getElementById("downloadSection");
const downloadLink = document.getElementById("downloadLink");
const completionMessage = document.getElementById("completionMessage");

navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = event => audioChunks.push(event.data);
});

const containerIds = {
  rolePlayCards2019: 'rolePlay2019',
  pictureBasedCards2019: 'picture2019',
  rolePlayCards2022: 'rolePlay2022',
  pictureBasedCards2022: 'picture2022',
  rolePlayCards2024: 'rolePlay2024',
  pictureBasedCards2024: 'picture2024'
};

function populateButtons(sourceData, containerId) {
  const container = document.getElementById(containerId);
  Object.keys(sourceData).forEach(set => {
    const btn = document.createElement("button");
    btn.textContent = set;
    btn.onclick = () => startSet(set, sourceData[set]);
    container.appendChild(btn);
  });
}


populateButtons(rolePlayCards2019, "rolePlay2019");
populateButtons(pictureBasedCards2019, "picture2019");
populateButtons(rolePlayCards2022, "rolePlay2022");
populateButtons(pictureBasedCards2022, "picture2022");
populateButtons(rolePlayCards2024, "rolePlay2024");
populateButtons(pictureBasedCards2024, "picture2024");

function startSet(setName, questions) {
  currentSet = questions;
  currentIndex = 0;
  transcriptEnabled = false;
  audioChunks = [];
  mediaRecorder.start();
  transcriptBox.textContent = "";
  transcriptContainer.classList.add("hidden");
  showTranscriptButton.textContent = "Transcript: OFF";
  askQuestion();
  downloadSection.classList.add("hidden");
}

function askQuestion() {
  if (currentIndex < currentSet.length) {
    let utterance = new SpeechSynthesisUtterance(currentSet[currentIndex]);
    utterance.lang = "ja-JP";
    utterance.voice = synth.getVoices().find(v => v.lang === "ja-JP") || synth.getVoices()[0];
    utterance.onend = () => {
      if (transcriptEnabled) {
        transcriptBox.textContent = currentSet[currentIndex];
        transcriptContainer.classList.remove("hidden");
      }
    };
    synth.speak(utterance);
  } else {
    finishRecording();
  }
}

nextQuestionButton.onclick = () => {
  currentIndex++;
  askQuestion();
};

skipQuestionButton.onclick = () => {
  currentIndex++;
  askQuestion();
};

showTranscriptButton.onclick = () => {
  transcriptEnabled = !transcriptEnabled;
  showTranscriptButton.textContent = transcriptEnabled ? "Transcript: ON" : "Transcript: OFF";
  if (transcriptEnabled && currentSet[currentIndex]) {
    transcriptBox.textContent = currentSet[currentIndex];
    transcriptContainer.classList.remove("hidden");
  } else {
    transcriptContainer.classList.add("hidden");
  }
};

function finishRecording() {
  mediaRecorder.stop();
  mediaRecorder.onstop = () => {
    const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
    const audioUrl = URL.createObjectURL(audioBlob);
    downloadLink.href = audioUrl;
    downloadLink.classList.remove("hidden");
    downloadLink.download = "recording.wav";
    completionMessage.textContent = "Congratulations! You've completed this question set.";
    downloadSection.classList.remove("hidden");
  };
}
  
