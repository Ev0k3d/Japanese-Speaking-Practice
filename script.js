const rolePlayCards2019 = {
    "2019 HP1": [
      "この写真について話してください。",
      "自動販売機について、どう思いますか。",
      "最近、どこで買い物をしましたか。",
      "友だちの誕生日プレゼントに、何を買いますか。",
      "買い物はインターネットでしますか。それとも、町に行きますか。"
    ],
    "2019 HP2": [
      "この写真について話してください。",
      "パーティーについて、どう思いますか。",
      "今まで、祭りで何をしましたか。",
      "今度の誕生日に、何が欲しいですか。",
      "今度のクリスマスに、何をしますか。"
    ],
    "2019 HP3": [
      "この写真について話してください。",
      "着物について、どう思いますか。",
      "最近、どんな洋服を買いましたか。",
      "将来、制服が着たいですか。",
      "今度の週末、何が買いたいですか。"
    ],
    "2019 HP4": [
      "この写真について話してください。",
      "グループ旅行について、どう思いますか。",
      "最近、どんなおもしろい町に行きましたか。",
      "今度、田舎で何がしたいですか。",
      "今年の夏、どこに行きたいですか。"
    ],
    "2019 HP5": [
      "この写真について話してください。",
      "修学旅行について、どう思いますか。",
      "教室の外で、どんなことを勉強しましたか。",
      "将来、修学旅行で、どこに行きたいですか。",
      "学校で、どんな新しいイベントがしたいですか。"
    ],
    "2019 HP6": [
      "この写真について話してください。",
      "日本のスポーツについて、どう思いますか。",
      "今まで、どんなクラブ活動をしましたか。",
      "これから、どんな修学旅行に行きたいですか。",
      "将来、学校で何がしたいですか。"
    ],
    "2019 HP7": [
      "この写真について話してください。",
      "アルバイトについて、どう思いますか。",
      "最近、うちでどんな手伝いをしましたか。",
      "アルバイトのお金で何を買いたいですか。",
      "将来、どんな仕事がしたいですか。"
    ],
    "2019 HP8": [
      "この写真について話してください。",
      "コンピューターでの勉強について、どう思いますか。",
      "日本語の勉強で、何が一番難しかったですか。",
      "他の外国語も勉強したいですか。",
      "これから、どうやって日本語を使いますか。"
    ],
    "2019 HP9": [
      "この写真について話してください。",
      "環境にいい乗り物について、どう思いますか。",
      "今まで、どんなリサイクルしましたか。",
      "将来、どんな環境保護活動をしたいですか。",
      "学校で何をリサイクルしていますか。"
    ],
    "2019 HP10": [
      "この写真について話してください。",
      "国際スポーツ・イベントについて、どう思いますか。",
      "最近、友だちとスポーツをしましたか。",
      "将来、外国料理は、何が食べたいですか。",
      "将来、どんなイベントに行きたいですか。"
    ]
  };
  

pictureBasedCards2019 = {
    "2019 HP1": [
      "このしゃしんについてはなしてください。",
      "じどうはんばいきについて、どうおもいますか。",
      "さいきん、どこでかいものをしましたか。",
      "ともだちのたんじょうびプレゼントに、なにをかいますか。",
      "かいものはインターネットでしますか。それとも、まちにいきますか。"
    ],
    "2019 HP2": [
      "このしゃしんについてはなしてください。",
      "パーティーについて、どうおもいますか。",
      "いままで、まつりでなにをしましたか。",
      "こんどのたんじょうびに、なにがほしいですか。",
      "こんどのクリスマスに、なにをしますか。"
    ],
    "2019 HP3": [
      "このしゃしんについてはなしてください。",
      "きものについて、どうおもいますか。",
      "さいきん、どんなようふくをかいましたか。",
      "しょうらい、せいふくがきたいですか。",
      "こんどのしゅうまつ、なにがかいたいですか。"
    ],
    "2019 HP4": [
      "このしゃしんについてはなしてください。",
      "グループりょこうについて、どうおもいますか。",
      "さいきん、どんなおもしろいまちにいきましたか。",
      "こんど、いなかでなにがしたいですか。",
      "ことしのなつ、どこにいきたいですか。"
    ],
    "2019 HP5": [
      "このしゃしんについてはなしてください。",
      "しゅうがくりょこうについて、どうおもいますか。",
      "きょうしつのそとで、どんなことをべんきょうしましたか。",
      "しょうらい、しゅうがくりょこうで、どこにいきたいですか。",
      "がっこうで、どんなあたらしいイベントがしたいですか。"
    ],
    "2019 HP6": [
      "このしゃしんについてはなしてください。",
      "にほんのスポーツについて、どうおもいますか。",
      "いままで、どんなクラブかつどうをしましたか。",
      "これから、どんなしゅうがくりょこうにいきたいですか。",
      "しょうらい、がっこうでなにがしたいですか。"
    ],
    "2019 HP7": [
      "このしゃしんについてはなしてください。",
      "アルバイトについて、どうおもいますか。",
      "さいきん、うちでどんなてつだいをしましたか。",
      "アルバイトのおかねでなにをかいたいですか。",
      "しょうらい、どんなしごとがしたいですか。"
    ],
    "2019 HP8": [
      "このしゃしんについてはなしてください。",
      "コンピューターでのべんきょうについて、どうおもいますか。",
      "にほんごのべんきょうで、なにがいちばんむずかしかったですか。",
      "ほかのがいこくごもべんきょうしたいですか。",
      "これから、どうやってにほんごをつかいますか。"
    ],
    "2019 HP9": [
      "このしゃしんについてはなしてください。",
      "かんきょうにいいのりものについて、どうおもいますか。",
      "いままで、どんなリサイクルしましたか。",
      "しょうらい、どんなかんきょうほごかつどうをしたいですか。",
      "がっこうでなにをリサイクルしていますか。"
    ],
    "2019 HP10": [
      "このしゃしんについてはなしてください。",
      "こくさいスポーツ・イベントについて、どうおもいますか。",
      "さいきん、ともだちとスポーツをしましたか。",
      "しょうらい、がいこくりょうりは、なにがたべたいですか。",
      "しょうらい、どんなイベントにいきたいですか。"
    ]
  };

  const rolePlayCards2022 = {
    "2022 HP1": [
      "ペンフレンドはなんじんですか。",
      "どうしてそのひとがすきですか。",
      "このまえのてがみに、なにについてかきましたか。",
      "しつもんがありますか。",
      "ほかにしつもんがありますか。"
    ],
    "2022 HP2": [
      "パーティーはなんようびのなんじですか。",
      "どうしてパーティーをしますか。",
      "まえのパーティーではなにをしましたか。",
      "しつもんがありますか。",
      "ほかにしつもんがありますか。"
    ],
    "2022 HP3": [
      "いらっしゃいませ。",
      "いま、どこからきょうとにきましたか。",
      "きょうとでなにがしたいですか。",
      "しつもんがありますか。",
      "ほかにしつもんがありますか。"
    ],
    "2022 HP4": [
      "イギリスのなつやすみはなんがつなんにちからですか。",
      "なつやすみになにをしますか。",
      "きょねんのなつやすみ、てんきはどうでしたか。",
      "しつもんがありますか。",
      "ほかにしつもんがありますか。"
    ],
    "2022 HP5": [
      "がっこうのスポーツ・デイはなんがつなんにちですか。",
      "がっこうのスポーツ・デイでなにがいちばんすきですか。",
      "きょねんのスポーツ・デイのてんきは、どうでしたか。",
      "しつもんがありますか。",
      "ほかにしつもんがありますか。"
    ],
    "2022 HP6": [
      "しゅうがくりょこうでなにをしますか。",
      "きょねんのしゅうがくりょこうのてんきはどうでしたか。",
      "しゅうがくりょこうで、だれにどんなおみやげをかいますか。",
      "しつもんがありますか。",
      "ほかにしつもんがありますか。"
    ],
    "2022 HP7": [
      "おかあさんはまいにちなんじからなんじまでしごとをしますか。",
      "おかあさんはどうしてそのしごとがすきですか。",
      "おかあさんはきのうしごとでなにをしましたか。",
      "しつもんがありますか。",
      "ほかにしつもんがありますか。"
    ],
    "2022 HP8": [
      "なんようびのなんじに、ボランティアをしますか。",
      "せんしゅう、ボランティアでなにをしましたか。",
      "どうしてボランティアをしますか。",
      "しつもんがありますか。",
      "ほかにしつもんがありますか。"
    ],
    "2022 HP9": [
      "いらっしゃいませ。",
      "なにごのじしょですか。",
      "にほんごがじょうずですね。いままでにほんでなにをしましたか。",
      "しつもんがありますか。",
      "ほかにしつもんがありますか。"
    ],
    "2022 HP10": [
      "いつ、だれとまつりにいきますか。",
      "どうしてまつりがすきですか。",
      "きょねん、まつりのひのてんきは、どうでしたか。",
      "しつもんがありますか。",
      "ほかにしつもんがありますか。"
    ]
  };
  
  const pictureBasedCards2022 = {
    "2022 HP1": [
      "このしゃしんについてはなしてください。",
      "がいこくじんのともだちはいいですね。どうおもいますか。",
      "さいきん、ともだちと なにをしましたか。",
      "しょうらい、ともだちと どこにいきたいですか。",
      "だれとりょこうにいくことがすきですか。"
    ],
    "2022 HP2": [
      "このしゃしんについてはなしてください。",
      "じもとのイベントはいいですね。どうおもいますか。",
      "さいきん、どんなりょうりをつくりましたか。",
      "しょうらい、どんなイベントにいきたいですか。",
      "うちのりょうりがいいですか、それとも、レストランのりょうりがいいですか。"
    ],
    "2022 HP3": [
      "このしゃしんについてはなしてください。",
      "がっこうのびじゅつのじゅぎょうはいいですね。どうおもいますか。",
      "さいきん、どんなてんらんかいにいきましたか。",
      "しょうらい、どんなものをつくりたいですか。",
      "ぶんかのイベントについて、どうおもいますか。"
    ],
    "2022 HP4": [
      "このしゃしんについてはなしてください。",
      "うみはいいですね。どうおもいますか。",
      "きょねんのなつやすみに、どこにいきましたか。",
      "つぎのやすみに、なにがしたいですか。",
      "かぞくでのやすみは、どうですか。"
    ],
    "2022 HP5": [
      "このしゃしんについてはなしてください。",
      "せいふくは かっこいいですね。どうおもいますか。",
      "さいきん、どんなテストが ありましたか。",
      "しけんのあと、なにをしますか。",
      "どんながっこうが、いいがっこうですか。"
    ],
    "2022 HP6": [
      "このしゃしんについてはなしてください。",
      "グループしゃしんはいいですね。どうおもいますか。",
      "さいきん、しゅうがくりょこうでなにをしましたか。",
      "らいねん、しゅうがくりょこうでどこにいきたいですか。",
      "がっこうのりょこうがすきですか、それとも、かぞくでのりょこうがすきですか。"
    ],
    "2022 HP7": [
      "このしゃしんについてはなしてください。",
      "わたしははいしゃにいくことがすきではありません。どうおもいますか。",
      "さいきん、けんこうにいいことは、なにをしましたか。",
      "しょうらい、どうやってひとをたすけますか。",
      "びょういんでのしごとについて、どうおもいますか。"
    ],
    "2022 HP8": [
      "このしゃしんについてはなしてください。",
      "ともだちとのべんきょうはたのしいですね。どうおもいますか。",
      "さいきん、としょかんでなにをしましたか。",
      "しょうらい、どんなほんがよみたいですか。",
      "コンピューターでのべんきょうがすきですか、それとも、ほんをつかってのべんきょうがすきですか。"
    ],
    "2022 HP9": [
      "このしゃしんについてはなしてください。",
      "そとでのかつどうはたのしいですね。どうおもいますか。",
      "さいきん、がいこくじんのともだちと、なにをしましたか。",
      "しょうらい、かんきょうをまもりたいです。どうしますか。",
      "ともだちとのかつどうについて、どうおもいますか。"
    ],
    "2022 HP10": [
      "このしゃしんについてはなしてください。",
      "ともだちと いっしょのかつどうはいいですね。どうおもいますか。",
      "さいきん、なにをして、ともだちをてつだいましたか。",
      "しょうらい、どうやってみずをたいせつにしますか。",
      "かんきょうほごは、ひとりでは、できません。どうおもいますか。"
    ]
  };
  
  let currentSet = [];
  let currentIndex = 0;
  let mediaRecorder;
  let audioChunks = [];
  let transcriptEnabled = false;
  const synth = window.speechSynthesis;
  
  const currentQuestion = document.getElementById("currentQuestion");
  const nextQuestionButton = document.getElementById("nextQuestionButton");
  const skipQuestionButton = document.getElementById("skipQuestionButton");
  const showTranscriptButton = document.getElementById("showTranscriptButton");
  const transcriptBox = document.getElementById("transcriptBox");
  const transcriptContainer = document.getElementById("transcriptContainer");
  const downloadSection = document.getElementById("downloadSection");
  const downloadLink = document.getElementById("downloadLink");
  const completionMessage = document.getElementById("completionMessage");
  
  navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.ondataavailable = event => audioChunks.push(event.data);
  });
  
  const containerIds = {
    rolePlayCards2019: 'rolePlay2019',
    pictureBasedCards2019: 'picture2019',
    rolePlayCards2022: 'rolePlay2022',
    pictureBasedCards2022: 'picture2022'
  };
  
  function populateButtons(sourceData, containerId) {
    const container = document.getElementById(containerId);
    Object.keys(sourceData).forEach(set => {
      const btn = document.createElement("button");
      btn.textContent = set;
      btn.onclick = () => startSet(set, sourceData[set]);
      container.appendChild(btn);
    });
  }
  
  populateButtons(rolePlayCards2019, "rolePlay2019");
  populateButtons(pictureBasedCards2019, "picture2019");
  populateButtons(rolePlayCards2022, "rolePlay2022");
  populateButtons(pictureBasedCards2022, "picture2022");
  
  function startSet(setName, questions) {
    currentSet = questions;
    currentIndex = 0;
    transcriptEnabled = false;
    audioChunks = [];
    mediaRecorder.start();
    transcriptBox.textContent = "";
    transcriptContainer.classList.add("hidden");
    showTranscriptButton.textContent = "Transcript: OFF";
    askQuestion();
    downloadSection.classList.add("hidden");
  }
  
  function askQuestion() {
    if (currentIndex < currentSet.length) {
      let utterance = new SpeechSynthesisUtterance(currentSet[currentIndex]);
      utterance.lang = "ja-JP";
      utterance.voice = synth.getVoices().find(v => v.lang === "ja-JP") || synth.getVoices()[0];
      utterance.onend = () => {
        if (transcriptEnabled) {
          transcriptBox.textContent = currentSet[currentIndex];
          transcriptContainer.classList.remove("hidden");
        }
      };
      synth.speak(utterance);
    } else {
      finishRecording();
    }
  }
  
  nextQuestionButton.onclick = () => {
    currentIndex++;
    askQuestion();
  };
  
  skipQuestionButton.onclick = () => {
    currentIndex++;
    askQuestion();
  };
  
  showTranscriptButton.onclick = () => {
    transcriptEnabled = !transcriptEnabled;
    showTranscriptButton.textContent = transcriptEnabled ? "Transcript: ON" : "Transcript: OFF";
    if (transcriptEnabled && currentSet[currentIndex]) {
      transcriptBox.textContent = currentSet[currentIndex];
      transcriptContainer.classList.remove("hidden");
    } else {
      transcriptContainer.classList.add("hidden");
    }
  };
  
  function finishRecording() {
    mediaRecorder.stop();
    mediaRecorder.onstop = () => {
      const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
      const audioUrl = URL.createObjectURL(audioBlob);
      downloadLink.href = audioUrl;
      downloadLink.classList.remove("hidden");
      downloadLink.download = "recording.wav";
      completionMessage.textContent = "Congratulations! You've completed this question set.";
      downloadSection.classList.remove("hidden");
    };
  }
  
